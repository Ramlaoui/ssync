#!/usr/bin/env python3
"""Simple test to verify compression functionality."""

import base64
import gzip


def test_compression():
    """Test basic compression functionality."""
    print("Testing Compression Pipeline")
    print("=" * 40)

    # Test data
    original = "This is test data\n" * 1000
    print(f"\n1. Original size: {len(original)} bytes")

    # Compress
    compressed = gzip.compress(original.encode("utf-8"))
    print(f"2. Compressed size: {len(compressed)} bytes")
    print(f"   Compression ratio: {(1 - len(compressed) / len(original)) * 100:.1f}%")

    # Base64 encode (for transport)
    encoded = base64.b64encode(compressed).decode("ascii")
    print(f"3. Base64 encoded size: {len(encoded)} bytes")

    # Decode and decompress
    decoded = base64.b64decode(encoded)
    decompressed = gzip.decompress(decoded).decode("utf-8")
    print(f"4. Decompressed size: {len(decompressed)} bytes")

    # Verify
    assert decompressed == original, "Data mismatch!"
    print("\n✓ Compression pipeline works correctly!")

    # Test with simulated remote command
    print("\n" + "=" * 40)
    print("Simulated Remote Commands:")
    print("  gzip -9 -c file.log | base64 -w0")
    print("  → Compresses and encodes for transport")
    print(f"  → Original: {len(original)} → Transported: {len(encoded)} bytes")
    print(f"  → Bandwidth savings: {(1 - len(encoded) / len(original)) * 100:.1f}%")


if __name__ == "__main__":
    test_compression()
    print("\n✓ All compression tests passed!")
