#!/bin/bash

# Setup script for SlurmManager iOS app Xcode project
# This script helps create a proper Xcode project with existing Swift files

echo "üöÄ SlurmManager iOS App - Xcode Project Setup"
echo "=============================================="

# Check if we're in the right directory
if [ ! -d "SlurmManager" ]; then
    echo "‚ùå Error: Please run this script from the ios-app directory"
    echo "   Current directory: $(pwd)"
    echo "   Expected: ios-app directory containing SlurmManager folder"
    exit 1
fi

# Check if Xcode is installed
if ! command -v xcodebuild &> /dev/null; then
    echo "‚ùå Error: Xcode is not installed"
    echo "   Please install Xcode from the Mac App Store"
    exit 1
fi

echo "‚úÖ Found SlurmManager directory"
echo ""

# Remove the placeholder project file
if [ -f "SlurmManager/SlurmManager.xcodeproj/project.pbxproj" ]; then
    echo "üóë  Removing placeholder project file..."
    rm -rf SlurmManager/SlurmManager.xcodeproj
fi

echo "üì± Creating Xcode project..."
echo ""
echo "Please follow these steps in Xcode:"
echo ""
echo "1Ô∏è‚É£  CREATING THE PROJECT:"
echo "   ‚Ä¢ Open Xcode"
echo "   ‚Ä¢ Click 'Create New Project' (or File ‚Üí New ‚Üí Project)"
echo "   ‚Ä¢ Choose: iOS ‚Üí App"
echo "   ‚Ä¢ Click 'Next'"
echo ""
echo "2Ô∏è‚É£  PROJECT CONFIGURATION:"
echo "   ‚Ä¢ Product Name: SlurmManager"
echo "   ‚Ä¢ Team: Select your Apple ID"
echo "   ‚Ä¢ Organization Identifier: com.yourname (or your company)"
echo "   ‚Ä¢ Bundle Identifier: (will auto-fill)"
echo "   ‚Ä¢ Interface: SwiftUI"
echo "   ‚Ä¢ Language: Swift"
echo "   ‚Ä¢ Use Core Data: ‚ùå Unchecked"
echo "   ‚Ä¢ Include Tests: ‚úÖ Checked"
echo "   ‚Ä¢ Click 'Next'"
echo ""
echo "3Ô∏è‚É£  SAVE LOCATION:"
echo "   ‚ö†Ô∏è  IMPORTANT: Save in THIS directory:"
echo "   üìÅ $(pwd)"
echo "   ‚Ä¢ The project name should be 'SlurmManager'"
echo "   ‚Ä¢ This will create SlurmManager.xcodeproj here"
echo ""
echo "4Ô∏è‚É£  AFTER PROJECT CREATES:"
echo "   a) Delete these default files (right-click ‚Üí Delete ‚Üí Move to Trash):"
echo "      ‚Ä¢ ContentView.swift"
echo "      ‚Ä¢ Assets.xcassets (optional, keep if you want)"
echo ""
echo "   b) Add our Swift files:"
echo "      ‚Ä¢ Right-click on the SlurmManager folder in Xcode"
echo "      ‚Ä¢ Choose 'Add Files to \"SlurmManager\"...'"
echo "      ‚Ä¢ Navigate to: $(pwd)/SlurmManager"
echo "      ‚Ä¢ Select ALL folders (Models, Services, Views, etc.)"
echo "      ‚Ä¢ ‚úÖ Copy items if needed: UNCHECKED"
echo "      ‚Ä¢ ‚úÖ Create groups: CHECKED"
echo "      ‚Ä¢ ‚úÖ Add to targets: SlurmManager CHECKED"
echo "      ‚Ä¢ Click 'Add'"
echo ""
echo "5Ô∏è‚É£  ADD PACKAGE DEPENDENCIES:"
echo "   ‚Ä¢ File ‚Üí Add Package Dependencies..."
echo "   ‚Ä¢ Add these packages (one at a time):"
echo ""
echo "   üì¶ Alamofire (Networking):"
echo "      URL: https://github.com/Alamofire/Alamofire"
echo "      Version: Up to Next Major Version 5.8.0"
echo ""
echo "   üì¶ Starscream (WebSocket):"
echo "      URL: https://github.com/daltoniam/Starscream"
echo "      Version: Up to Next Major Version 4.0.0"
echo ""
echo "   üì¶ KeychainAccess (Secure Storage):"
echo "      URL: https://github.com/kishikawakatsumi/KeychainAccess"
echo "      Version: Up to Next Major Version 4.2.0"
echo ""
echo "6Ô∏è‚É£  CONFIGURE INFO.PLIST:"
echo "   ‚Ä¢ Select project ‚Üí SlurmManager target ‚Üí Info tab"
echo "   ‚Ä¢ Add these keys:"
echo "     - App Transport Security Settings"
echo "       ‚Üí Exception Domains"
echo "         ‚Üí localhost"
echo "           ‚Ä¢ NSExceptionAllowsInsecureHTTPLoads: YES"
echo "           ‚Ä¢ NSIncludesSubdomains: YES"
echo "     - Privacy - Face ID Usage Description:"
echo "       \"Authenticate to access your SLURM jobs securely\""
echo ""
echo "7Ô∏è‚É£  RUN THE APP:"
echo "   ‚Ä¢ Select target device (iPhone 15 Pro simulator recommended)"
echo "   ‚Ä¢ Press Cmd+R or click ‚ñ∂Ô∏è Play button"
echo ""
echo "üìù Files to add from SlurmManager folder:"
ls -la SlurmManager/ | grep -E "swift$|/$" | grep -v "^\."
echo ""
echo "üéØ Quick command to open Xcode:"
echo "   open -a Xcode"
echo ""
echo "üìö Need help? Check the README:"
echo "   cat $(pwd)/../README.md"
echo ""
echo "‚ú® Once setup is complete, your app will:"
echo "   ‚Ä¢ Connect to your SLURM Manager API"
echo "   ‚Ä¢ Show real-time job updates"
echo "   ‚Ä¢ Support Face ID/Touch ID"
echo "   ‚Ä¢ Provide haptic feedback"
echo "   ‚Ä¢ Beautiful animations throughout"